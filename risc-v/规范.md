# RISC-V 架构上的调用规范

## c语言调用规范

| 寄存器组                        |     保存者     | 功能                                                                                                                                                                |
| ------------------------------- | :------------: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| a0 ~ a7 (x10 ~ x17)             |   调用者保存   | 用来传递输入参数。其中的 a0 和 a1 还用来保存返回值。                                                                                                                |
| t0 ~ t6 ( x5 ~ x7, x28 ~ x31 )  |   调用者保存   | 作为临时寄存器使用，在被调函数中可以随意使用无需保存。                                                                                                              |
| s0 ~ s11 ( x8 ~ x9, x18 ~ x27 ) |  被调用者保存  | 作为临时寄存器使用，被调函数保存后才能在被调函数中使用。                                                                                                            |
| zero ( x0 )                     |       -        | 它恒为零，函数调用不会对它产生影响                                                                                                                                  |
| ra (x1)                         |   调用者保存   | 不过它并不会在每次调用子函数的时候都保存一次，而是在函数的开头和结尾保存/恢复即可。虽然 ra 看上去和其它被调用者保存寄存器保存的位置一样，但是它确实是调用者保存的。 |
| sp( x2 )                        | 被调用者保存的 | 栈指针 (Stack Pointer) 寄存器。                                                                                                                                     |
| fp( s0 )，                      |  被调用者保存  | 它既可作为s0临时寄存器，也可作为栈帧指针（Frame Pointer）寄存器，表示当前栈帧的起始位置。                                                                           |
| gp ( x3 ), tp( x4 )             |       -        | 在一个程序运行期间都不会变化，因此不必放在函数调用上下文中。                                                                                                        |

## 进入 S 特权级 Trap 的相关 CSR

| CSR 名  | 该 CSR 与 Trap 相关的功能                                            |
| ------- | -------------------------------------------------------------------- |
| sstatus | SPP 等字段给出 Trap 发生之前 CPU 处在哪个特权级（S/U）等信息         |
| sepc    | 当 Trap 是一个异常的时候，记录 Trap 发生之前执行的最后一条指令的地址 |
| scause  | 描述 Trap 的原因                                                     |
| stval   | 给出 Trap 附加信息                                                   |
| stvec   | 控制 Trap 处理代码的入口地址                                         |

## risc-v 中断

| Interrupt | Exception Code | Description                   |
| --------- | -------------- | ----------------------------- |
| 1         | 1              | Supervisor software interrupt |
| 1         | 3              | Machine software interrupt    |
| 1         | 5              | Supervisor timer interrupt    |
| 1         | 7              | Machine timer interrupt       |
| 1         | 9              | Supervisor external interrupt |
| 1         | 11             | Machine external interrupt    |

## [linux 系统调用规范](https://marcin.juszkiewicz.com.pl/download/tables/syscalls.html)
